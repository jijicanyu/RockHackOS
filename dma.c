#include "dma.h"

void dma_setup_floppy() {
    outb(0x0A, 0x06); // Mask DMA channel 2 (and 0)
    outb(0x0C, 0xFF); // Reset the master flip-flop
    outb(0x04, 0x00); // Address to 0x4000
    outb(0x04, 0x40);
    outb(0x0c, 0xFF); // Reset the master flip-flop again
    outb(0x05, 0xFF); // Count to 0x23ff
    outb(0x05, 0x01);
    outb(0x81, 0x00); // Register 0x00
    outb(0x0A, 0x02);
}

void dma_prepare_floppy_write() {
    outb(0x0A, 0x06);
    outb(0x0B, 0x5A);
    outb(0x0A, 0x02);
}

void dma_prepare_floppy_read() {
    outb(0x0A, 0x06);
    outb(0x0B, 0x56);
    outb(0x0A, 0x02);
}
